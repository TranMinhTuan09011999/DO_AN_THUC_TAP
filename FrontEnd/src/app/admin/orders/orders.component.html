<!-- main content -->
<div class="page-wrapper">
    <div class="main-content" id="cart" style="padding-top: 3rem;">
        <!-- main -->
        <div id="wrapper-site">
            <div class="page">
                <div class="section-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="d-flex justify-content-between align-items-center">
                                    <ul class="nav nav-tabs page-header-tab">
                                        <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#Unconfirmed">Chưa xác nhận</a></li>
                                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Comfirmed">Đã xác nhận</a></li>
                                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Delivering">Đang giao</a></li>
                                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Delivered">Đã giao</a></li>
                                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Canceled">Đã hủy</a></li>
                                    </ul>
                                    <div class="header-action d-md-flex">
                                        <div class="row filter-row" style="width: 34rem;">
                                            <div class="col-sm-6 col-md-4 col-lg-4 col-xl-4 col-12" style="padding: 0px 3px;">
                                                <label class="focus-label">* Từ: </label>
                                                <div class="form-group">
                                                    <input class="form-control" type="date" name="input" [(ngModel)]="fromDate" max="{{today}}" style="width: 10.4rem;" required (change)="onChange()" />
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-md-4 col-lg-4 col-xl-4 col-12" style="padding: 0px 3px;">
                                                <label class="focus-label">* Đến: </label>
                                                <div class="form-group">
                                                    <input *ngIf="disabled == true" class="form-control" type="date" name="input" [(ngModel)]="toDate" style="width: 10.4rem;" required disabled/>
                                                    <input *ngIf="disabled == false" class="form-control" type="date" name="input" min={{fromDate}} max={{today}} style="width: 10.4rem;" [(ngModel)]="toDate" required />
                                                    <!-- max="2014-12-31" -->
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-md-4 col-lg-4 col-xl-4 col-12">
                                                <label class="focus-label"></label>
                                                <button class="btn btn-success btn-block" style="margin-top: 8px;
                                                    padding: 6px;min-height: 0px;" type="submit" (click)="search(mymodal)">Tìm kiếm</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section-body mt-3">
                    <div class="container-fluid">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="Unconfirmed" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                                                        <thead>
                                                            <tr>
                                                                <th>Ngày đặt</th>
                                                                <th>Họ tên người nhận</th>
                                                                <th class="w100">Địa chỉ người nhận</th>
                                                                <th class="w100">SDT người nhận</th>
                                                                <th>Chức năng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody *ngFor="let unconfirmOrder of unconfirmOrders">
                                                            <tr>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter2" (click)="$event.preventDefault();showOrderDetail(unconfirmOrder.orderId)">{{unconfirmOrder.dateOfOrder}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter2" (click)="$event.preventDefault();showOrderDetail(unconfirmOrder.orderId)">{{unconfirmOrder.lastnameOfReveiver}} {{unconfirmOrder.firstnameOfReveiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter2" (click)="$event.preventDefault();showOrderDetail(unconfirmOrder.orderId)">{{unconfirmOrder.addressOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter2" (click)="$event.preventDefault();showOrderDetail(unconfirmOrder.orderId)">{{unconfirmOrder.phoneOfReceiver}}</td>
                                                                <td>
                                                                    <a href="" class="btn btn-light" style="font-size: 0.9rem;
                                                                padding: 0px 9px; background-color: rgb(230, 82, 82); margin-right: 1rem;" (click)="$event.preventDefault();confirm(mymodal1, unconfirmOrder.orderId)"> Confirm</a>
                                                                    <a href="" class="btn btn-light" style="font-size: 0.9rem;
                                                                padding: 0px 9px; background-color: rgb(230, 82, 82); " (click)="$event.preventDefault();cancel(unconfirmOrder.orderId)"> Cancel</a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="Comfirmed" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                                                        <thead>
                                                            <tr>
                                                                <th>Ngày đặt</th>
                                                                <th>Họ tên người nhận</th>
                                                                <th class="w100">Địa chỉ người nhận</th>
                                                                <th class="w100">SDT người nhận</th>
                                                                <th>Chức năng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody *ngFor="let confirmOrder of confirmOrders">
                                                            <tr>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(confirmOrder.orderId)">{{confirmOrder.dateOfOrder}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(confirmOrder.orderId)">{{confirmOrder.lastnameOfReveiver}} {{confirmOrder.firstnameOfReveiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(confirmOrder.orderId)">{{confirmOrder.addressOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(confirmOrder.orderId)">{{confirmOrder.phoneOfReceiver}}</td>
                                                                <td>
                                                                    <a data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-light" style="font-size: 0.9rem;
                                                                padding: 0px 9px; background-color: rgb(230, 82, 82); margin-right: 1rem;" (click)="$event.preventDefault();delivery(confirmOrder.orderId)"> Delivery</a>
                                                                    <a href="" class="btn btn-light" style="font-size: 0.9rem;
                                                                padding: 0px 9px; background-color: rgb(230, 82, 82); " (click)="$event.preventDefault();cancel(confirmOrder.orderId)"> Cancel</a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="Delivering" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                                                        <thead>
                                                            <tr>
                                                                <th>Ngày đặt</th>
                                                                <th>Họ tên người nhận</th>
                                                                <th class="w100">Địa chỉ người nhận</th>
                                                                <th class="w100">SDT người nhận</th>
                                                                <th class="w100">Ngày giao</th>
                                                                <th class="w100">Nhân viên</th>
                                                                <th class="w100">Nhân viên giao</th>
                                                                <th>Chức năng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody *ngFor="let deliveringOrder of deliveringOrders">
                                                            <tr>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.dateOfOrder}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.lastnameOfReveiver}} {{deliveringOrder.firstnameOfReveiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.addressOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.phoneOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.deliveryDate}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.employee.lastname}} {{deliveringOrder.employee.firstname}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveringOrder.orderId)">{{deliveringOrder.employeeDelivery.lastname}} {{deliveringOrder.employeeDelivery.firstname}}</td>
                                                                <td>
                                                                    <a class="btn btn-light" style="font-size: 0.9rem;
                                                                padding: 0px 9px; background-color: rgb(230, 82, 82); margin-right: 1rem;" (click)="$event.preventDefault();delivered(deliveringOrder.orderId)"> Delivered</a>
                                                                    <a href="" class="btn btn-light" style="font-size: 0.9rem;
                                                                    padding: 0px 9px; background-color: rgb(230, 82, 82); " (click)="$event.preventDefault();cancel(deliveringOrder.orderId)"> Cancel</a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="Delivered" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                                                        <thead>
                                                            <tr>
                                                                <th>Ngày đặt</th>
                                                                <th>Họ tên người nhận</th>
                                                                <th class="w100">Địa chỉ người nhận</th>
                                                                <th class="w100">SDT người nhận</th>
                                                                <th class="w100">Ngày giao</th>
                                                                <th class="w100">Nhân viên</th>
                                                                <th class="w100">Nhân viên giao</th>
                                                                <th>Chức năng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody *ngFor="let deliveredOrder of deliveredOrders">
                                                            <tr>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.dateOfOrder}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.lastnameOfReveiver}} {{deliveredOrder.firstnameOfReveiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.addressOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.phoneOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.deliveryDate}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.employee.lastname}} {{deliveredOrder.employee.firstname}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(deliveredOrder.orderId)">{{deliveredOrder.employeeDelivery.lastname}} {{deliveredOrder.employeeDelivery.firstname}}</td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="Canceled" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                                                        <thead>
                                                            <tr>
                                                                <th>Ngày đặt</th>
                                                                <th>Họ tên người nhận</th>
                                                                <th class="w100">Địa chỉ người nhận</th>
                                                                <th class="w100">SDT người nhận</th>
                                                                <th>Chức năng</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody *ngFor="let canceledOrder of canceledOrders">
                                                            <tr>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(canceledOrder.orderId)">{{canceledOrder.dateOfOrder}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(canceledOrder.orderId)">{{canceledOrder.lastnameOfReveiver}} {{canceledOrder.firstnameOfReveiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(canceledOrder.orderId)">{{canceledOrder.addressOfReceiver}}</td>
                                                                <td data-toggle="modal" data-target="#exampleModalCenter" (click)="$event.preventDefault();showOrderDetail(canceledOrder.orderId)">{{canceledOrder.phoneOfReceiver}}</td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-wrapper" id="exampleModalCenter">
    <div class="modal-dialog modal-dialog-centered" role="document" style="min-width: 92%;">
        <div class="modal-content">
            <div class="modal-body">
                <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                    <thead>
                        <tr>
                            <th>Hình ảnh</th>
                            <th>Tên sản phẩm</th>
                            <th>Kích thước</th>
                            <th>Màu</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                        </tr>
                    </thead>
                    <tbody *ngFor="let orderDetail of orderDetails">
                        <tr>
                            <td>
                                <img src="http://localhost:8080/api/image/imageProduct/{{orderDetail.productDetails.productDetailId}}" class="card-img-top img-responsive" style="height :100px;width:100px">
                            </td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.product.productName}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.size.size}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.color.colorName}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.quantity}}</td>
                            <td style="padding-top: 3rem;" *ngIf="orderDetail.discount > 0">
                                <span class="price">{{orderDetail.price - orderDetail.price*orderDetail.discount/100 | currency: "VND"}}</span>
                                <del style="margin-left: 1rem;" class="regular-price">{{orderDetail.price | currency: "VND"}}</del>
                            </td>
                            <td style="padding-top: 3rem;" *ngIf="orderDetail.discount == 0">{{orderDetail.price | currency: "VND"}}</td>
                            <td></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="text-right">Tổng: </td>
                            <td>{{total | currency: "VND"}}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-wrapper" id="exampleModalCenter2">
    <div class="modal-dialog modal-dialog-centered" role="document" style="min-width: 92%;">
        <div class="modal-content">
            <div class="modal-body">
                <table class="table table-hover table-striped table-vcenter mb-0 text-nowrap">
                    <thead>
                        <tr>
                            <th>Hình ảnh</th>
                            <th>Tên sản phẩm</th>
                            <th>Kích thước</th>
                            <th>Màu</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                        </tr>
                    </thead>
                    <tbody *ngFor="let orderDetail of orderDetails">
                        <tr>
                            <td>
                                <img src="http://localhost:8080/api/image/imageProduct/{{orderDetail.productDetails.productDetailId}}" class="card-img-top img-responsive" style="height :100px;width:100px">
                            </td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.product.productName}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.size.size}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.productDetails.color.colorName}}</td>
                            <td style="padding-top: 3rem;">{{orderDetail.quantity}}</td>
                            <td style="padding-top: 3rem;" *ngIf="orderDetail.discount > 0">
                                <span class="price">{{orderDetail.price - orderDetail.price*orderDetail.discount/100 | currency: "VND"}}</span>
                                <del style="margin-left: 1rem;" class="regular-price">{{orderDetail.price | currency: "VND"}}</del>
                            </td>
                            <td style="padding-top: 3rem;" *ngIf="orderDetail.discount == 0">{{orderDetail.price | currency: "VND"}}</td>
                            <td style="position: relative;">
                                <img src="assets/img/SoldOut.png" alt="img" style="width: 80px; position: absolute;top: -2px;
                                                                right: -1px;" *ngIf="compare(orderDetail.quantity,orderDetail.productDetails.quantity) == false">
                                <h3 style="width: 55px;
                                                                text-align: center;
                                                                font-weight: 600;
                                                                color: #f9e601;
                                                                position: absolute;
                                                                top: 0px;
                                                                right: 12px;
                                                                white-space: normal;" *ngIf="compare(orderDetail.quantity,orderDetail.productDetails.quantity) == false">NOT ENOUGH</h3>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="text-right">Tổng: </td>
                            <td>{{total | currency: "VND"}}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
<form [formGroup]="this.dataForm" (ngSubmit)="onSubmit()">
    <div class="modal fade modal-wrapper" id="exampleModalCenter1">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="text-center">Thêm nhân viên giao và thuế</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label>Mã nhân viên: </label>
                                <select formControlName="deliveryEmployee" class="form-control">
                                    <option *ngFor="let employee of employees" [ngValue]="employee.id">
                                        {{employee.lastname}} {{employee.firstname}}
                                      </option>
                                    </select>
                                <div *ngIf="submitted && f.deliveryEmployee.errors">
                                    <div *ngIf="f.deliveryEmployee.errors.required" class="errors">* Vui lòng nhập mã nhân viên</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label>Mã thuế: </label>
                                <input placeholder="" class="form-control" type="text" formControlName="tax">
                                <div *ngIf="submitted && f.tax.errors">
                                    <div *ngIf="f.tax.errors.required" class="errors"> * Vui lòng nhập mã thuế</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="m-t-20 text-center">
                        <button class="btn btn-primary submit-btn btn-rounded" type="submit">Thêm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<ng-template #mymodal let-modal>
    <div class="modal-header" style="background-color: #2661e4;
    height: 3.4rem;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #fff;
        font-size: 1.1rem;">Thông báo</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true" style="color: #fff;">×</span>
      </button>
    </div>
    <div class="modal-body">
        {{message}}
    </div>
    <div class="modal-footer" style="height: 3rem;">
        <button style="background-color: #0678ec;
        color: #fff;
        border: none;" type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Ok</button>
    </div>
</ng-template>

<ng-template #mymodal1 let-modal>
    <div class="modal-header" style="background-color: #2661e4;
    height: 3.4rem;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #fff;
        font-size: 1.1rem;">Thông báo</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true" style="color: #fff;">×</span>
      </button>
    </div>
    <div class="modal-body">
        {{message1}}
    </div>
    <div class="modal-footer" style="height: 3rem;">
        <button style="background-color: #0678ec;
        color: #fff;
        border: none;" type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Ok</button>
    </div>
</ng-template>